<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="../../css/pygment_default.css" rel="stylesheet">
  <link href="../../css/main.css" rel="stylesheet">
  <link href="../../css/print.css" rel="stylesheet" media="print">

  <title>IoTy Documentation</title>
</head>

<body>
    <div id="header">
        <div id="header-left">
            <a id="home" href="../../index.html"><i class="fa fa-home"></i></a>
            &nbsp;&nbsp;/&nbsp;&nbsp;
            IoTy Documentation
        </div>
        <div id="header-right">
            <a href="https://aposteriori.com.sg">
                <img src="../../images/logo.png">
            </a>
        </div>
    </div>

    <div id="body">
        <div id="sidebarOverlay"></div>
        <nav id="sidebar" role="navigation">
            <div id="sidebarHeader">Internet-of-Things made easy</div>
            <p>Intro to IoTy</p><ul><a href="../10-Introduction/10-Intro.html"><li >Introduction</li></a><a href="../10-Introduction/20-First-Program.html"><li >First Program</li></a><a href="../10-Introduction/30-Connection-Modes.html"><li >Connection Modes</li></a><a href="../10-Introduction/40-Monitor.html"><li >Monitor</li></a></ul><p>Basic Features</p><ul><a href="../20-Basics/10-GPIO-Pins.html"><li >GPIO Pins</li></a><a href="../20-Basics/20-Analog-Read-and-Write.html"><li >Analog Read and Write</li></a><a href="../20-Basics/30-Servo.html"><li >Servo</li></a><a href="../20-Basics/40-Ultrasonic-Distance.html"><li >Ultrasonic Distance (HC-SR04)</li></a><a href="../20-Basics/99-Python-Docs---pin.html"><li >Python Docs - pin</li></a></ul><p>Extensions</p><ul><a href="../100-Extensions/10-Gyro.html"><li >Gyro (MPU-6050)</li></a><a href="../100-Extensions/20-Servo-driver.html"><li class="current">Servo Driver (PCA9685)</li></a><a href="../100-Extensions/30-SSD1306.html"><li >OLED Screen (SSD1306)</li></a></ul><p>Others Components</p><ul><a href="../200-Others/10-hbridge.html"><li >Intro to H-Bridge</li></a><a href="../200-Others/12-hbridgeControl2Pins.html"><li >Controlling a H-Bridge (2 pins)</li></a><a href="../200-Others/14-hbridgeControl3Pins.html"><li >Controlling a H-Bridge (3 pins)</li></a></ul>
        </nav>
        <div id="content">
            <h1>Servo Driver (PCA9685)</h1>
<p>While we can control servos using the IO pins, there are a some problems with that approach...</p>
<ul>
<li>Requires one pin for each servo</li>
<li>Wiring can be a hassle if you need to provide separate power for the servo</li>
</ul>
<p>One way to work around these limitations is to use the PCA9685 servo driver board.</p>
<p><img alt="" src="images/PCA9685.webp" /></p>
<p>Benefits of this board are...</p>
<ul>
<li>Uses the I2C communication protocol; only requires 2 pins and multiple I2C devices can share the same pins.</li>
<li>Each PCA9685 board can control up to 16 servos, and you can use up to 62 of these boards simultaneously (...for 992 servos total).</li>
<li>Simplified wiring.</li>
</ul>
<h2>Pins</h2>
<p><img alt="" src="images/PCA9685_pinout.webp" /></p>
<table>
<thead>
<tr>
<th>Pin</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Servo Power Screw Terminals</td>
<td>Power supply for the <strong>Servos Only</strong>. Most servos max out at 7.2V so you should not exceed that.</td>
</tr>
<tr>
<td>Output to Servos</td>
<td>16 outputs for servos. You can use as many or as little as you need, but make sure you match the color on the servo wires.</td>
</tr>
<tr>
<td>GND (Signal)</td>
<td>Ground pin. This should be connected to the <strong>GND</strong> pin on the ESP32. This is the same as the GND pin on the screw terminals.</td>
</tr>
<tr>
<td>OE (Signal)</td>
<td>Output Enable pin. If given a <strong>HIGH</strong> (3.3V or 5V) signal, it will disable all the outputs. You can leave this disconnected if you're not using it.</td>
</tr>
<tr>
<td>SCL (Signal)</td>
<td>Serial Clock. This is used to communicate with the ESP32 using the I2C protocol.</td>
</tr>
<tr>
<td>SDA (Signal)</td>
<td>Serial Data. This is used to communicate with the ESP32 using the I2C protocol.</td>
</tr>
<tr>
<td>VCC (Signal)</td>
<td>Provides the PCA9685 with power. This does not provide power to the servo. Connect to <strong>3V3</strong> on the ESP32.</td>
</tr>
<tr>
<td>V+ (Signal)</td>
<td>Power supply for the <strong>Servos Only</strong>. This is the same as the V+ pin on the screw terminals, and you only need to connect one of them.</td>
</tr>
<tr>
<td>Signal pins on right side</td>
<td>Identical to the pins on the left side. Useful to chain multiple PCA9685 boards together, but should otherwise leave them alone.</td>
</tr>
</tbody>
</table>
<h2>Power</h2>
<p>The PCA9685 board has <strong>TWO</strong> power supply.
The <strong>V+</strong> pins only supply power to the servos, and does not power the chips on the board.
The <strong>VCC</strong> pin only supply power to the board, and does not power the servos.
<strong>Both</strong> pins must be powered for the board to work.</p>
<p>For testing purposes, you can connect the <strong>VIN</strong> pin on the EPS32 to the <strong>V+</strong> pin on the PCA9685.
The <strong>VIN</strong> pin cannot supply much current, so this will only work with a few lightly loaded servos.</p>
<p><img alt="" src="images/pca9685VinPower.webp" /></p>
<p>To provide sufficient power to the servos, you should use either...</p>
<ul>
<li>A separate battery pack supplying at most 7.2V (eg. 2 x 18650 batteries).</li>
</ul>
<p><img alt="" src="images/pca9685BatteryPower.webp" /></p>
<p>...or if your battery pack is higher than 7.2V (eg. 12V)...</p>
<ul>
<li>A voltage regulator to reduce the higher voltage down to 7.2V.</li>
</ul>
<p><img alt="" src="images/pca9685RegulatorPower.webp" /></p>
<h2>Wiring</h2>
<p>The example below uses power from <strong>VIN</strong>.
Modify accordingly if you are using a different power source for the servos.</p>
<p><img alt="" src="images/pca9685Wiring.webp" /></p>
<h2>Code</h2>
<p>This code will change the angle for servo on channel 15, from 0 to 180 degrees and back.</p>
<h3>Blocks</h3>
<p><img alt="" src="images/pca9685Blocks.webp" /></p>
<h3>Python</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">machine</span>
<span class="kn">import</span> <span class="nn">pca9685</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">i2c0</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">I2C</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">pca9685_device</span> <span class="o">=</span> <span class="n">pca9685</span><span class="o">.</span><span class="n">PCA9685</span><span class="p">(</span><span class="n">i2c0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">pca9685_device</span><span class="o">.</span><span class="n">servo_deg</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pca9685_device</span><span class="o">.</span><span class="n">servo_deg</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<h3>Results</h3>
<p>You should see the servo turn from 0 to 180 degrees and back.
Depending on the model of your servo, you may find it turning less or more than 180 degrees; different servo models interpretes the servo command signal differently.</p>
<h1><code>class PCA9685</code> - control PCA9685 servo driver</h1>
<div class="custom_lib_docs">
<h2>Constructors</h2>
<h3>pca9685.PCA9685(i2c, addr=64)</h3>
<p>Create a PCA9685 object.</p>
<p>The arguments are:</p>
<ul>
<li>
<p><code>i2c</code> An i2c object.</p>
</li>
<li>
<p><code>addr</code> The i2c address of the gyro. By default, this should be 64.</p>
</li>
</ul>
<p>Returns an <code>PCA9685</code> object.</p>
<h2>Methods</h2>
<h3>PCA9685.set_frequency(freq)</h3>
<p>Sets the PWM frequency for the PCA9685.
Most RC servos works at 50Hz.</p>
<p>The arguments are:</p>
<ul>
<li><code>freq</code> A number specifying the frequency in Hz.</li>
</ul>
<p>Returns <code>None</code>.</p>
<h3>PCA9685.pwm(channel, duty)</h3>
<p>Sets the PWM duty cycle for the specified channel.
This can be useful when using the PCA9685 to control LED or brushed motors (...not servo motors).</p>
<p>The arguments are:</p>
<ul>
<li>
<p><code>channel</code> An integer specifying the channel (0 to 15)</p>
</li>
<li>
<p><code>duty</code> A number representing the duty cycle (0 to 4095).</p>
</li>
</ul>
<p>Returns <code>None</code>.</p>
<h3>PCA9685.servo_us(channel, us)</h3>
<p>Sets the pulse width for the specified channel.
When controlling servos, you would typically use values ranging from 500us to 2500us.</p>
<p>The arguments are:</p>
<ul>
<li>
<p><code>channel</code> An integer specifying the channel (0 to 15)</p>
</li>
<li>
<p><code>us</code> A number representing the pulse width in microseconds (us).</p>
</li>
</ul>
<p>Returns <code>None</code>.</p>
<h3>PCA9685.servo_deg(channel, deg)</h3>
<p>Sets the angle for the servo on the specified channel.
The output PWM width will range from 1000us (0 deg) to 2000us (180 deg).</p>
<p>Depending on the model of your servo, you may find it turning less or more than 180 degrees; different servo models interpretes the servo command signal differently.</p>
<p>The arguments are:</p>
<ul>
<li>
<p><code>channel</code> An integer specifying the channel (0 to 15)</p>
</li>
<li>
<p><code>us</code> A number representing the angle in degrees.</p>
</li>
</ul>
<p>Returns <code>None</code>.</p>
</div>
        </div>
        <button type="button" id="hamburger">
            <div id="hamburgerTop"></div>
            <div id="hamburgerBottom"></div>
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('hamburger').addEventListener('click', function() {
                document.getElementById('body').classList.toggle('close');
            });

            let currentEle = document.querySelector('#sidebar li.current');
            currentEle.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        });
    </script>
</body>
</html>