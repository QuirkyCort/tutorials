<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="../../css/pygment_default.css" rel="stylesheet">
  <link href="../../css/main.css" rel="stylesheet">
  <link href="../../css/print.css" rel="stylesheet" media="print">

  <title>IoTy Documentation</title>
</head>

<body>
    <div id="header">
        <div id="header-left">
            <a id="home" href="../../index.html"><i class="fa fa-home"></i></a>
            &nbsp;&nbsp;/&nbsp;&nbsp;
            IoTy Documentation
        </div>
        <div id="header-right">
            <a href="https://aposteriori.com.sg">
                <img src="../../images/logo.png">
            </a>
        </div>
    </div>

    <div id="body">
        <div id="sidebarOverlay"></div>
        <nav id="sidebar" role="navigation">
            <div id="sidebarHeader">Internet-of-Things made easy</div>
            <p>Intro to IoTy</p><ul><a href="../10-Introduction/10-Intro.html"><li >Introduction</li></a><a href="../10-Introduction/20-First-Program.html"><li >First Program</li></a><a href="../10-Introduction/30-Connection-Modes.html"><li >Connection Modes</li></a><a href="../10-Introduction/40-Monitor.html"><li >Monitor</li></a></ul><p>Basic Features (GPIO)</p><ul><a href="../20-Basics-GPIO/10-GPIO-Pins.html"><li >GPIO Pins</li></a><a href="../20-Basics-GPIO/20-Analog-Read-and-Write.html"><li >Analog Read and Write</li></a><a href="../20-Basics-GPIO/30-Servo.html"><li >Servo</li></a><a href="../20-Basics-GPIO/40-Ultrasonic-Distance.html"><li >Ultrasonic Distance (HC-SR04)</li></a><a href="../20-Basics-GPIO/99-Python-Docs---pin.html"><li >Python Docs - pin</li></a></ul><p>Extensions (Software)</p><ul><a href="../100-Extensions_Software/10-urequests.html"><li class="current">HTTP Requests (urequests)</li></a><a href="../100-Extensions_Software/20-EZ-ESP-NOW.html"><li >EZ ESP-NOW</li></a><a href="../100-Extensions_Software/30-EZ-HTTPD.html"><li >EZ HTTP (Web Server)</li></a><a href="../100-Extensions_Software/40-non-block.html"><li >Non-Blocking Read</li></a><a href="../100-Extensions_Software/50-EZ-Timer.html"><li >EZ Timer</li></a></ul><p>Extensions (Hardware)</p><ul><a href="../110-Extensions_Hardware/10-Gyro.html"><li >Gyro (MPU-6050)</li></a><a href="../110-Extensions_Hardware/20-Servo-driver.html"><li >Servo Driver (PCA9685)</li></a><a href="../110-Extensions_Hardware/30-SSD1306.html"><li >OLED Screen (SSD1306)</li></a><a href="../110-Extensions_Hardware/40-Neopixel.html"><li >Neopixel (WS2812 LEDs)</li></a><a href="../110-Extensions_Hardware/50-I2C-LCD.html"><li >I2C LCD (HD44780 + PCF8574)</li></a><a href="../110-Extensions_Hardware/60-DHT11.html"><li >Temperature and Humidity (DHT11, DHT22, AM2302)</li></a><a href="../110-Extensions_Hardware/70-EZ-DS18X20.html"><li >Temperature Sensor (DS18S20, DS18B20)</li></a><a href="../110-Extensions_Hardware/80-GPS.html"><li >GPS (NMEA over serial)</li></a><a href="../110-Extensions_Hardware/90-hx711.html"><li >Analog-to-Digital (HX711)</li></a><a href="../110-Extensions_Hardware/100-hx710.html"><li >Analog-to-Digital (HX710)</li></a><a href="../110-Extensions_Hardware/110-MFRC522.html"><li >RFID Reader (MFRC522)</li></a><a href="../110-Extensions_Hardware/120-Magnetic-Sensor.html"><li >Magnetic Sensor (QMC5883L, HMC5883L)</li></a></ul><p>Others Components</p><ul><a href="../200-Others/10-hbridge.html"><li >Intro to H-Bridge</li></a><a href="../200-Others/12-hbridgeControl2Pins.html"><li >Controlling a H-Bridge (2 pins)</li></a><a href="../200-Others/14-hbridgeControl3Pins.html"><li >Controlling a H-Bridge (3 pins)</li></a></ul>
        </nav>
        <div id="content">
            <h1>HTTP Requests (urequests)</h1>
<p>This extension allows you to make http request (ie. retrieve webpages). You can use this to retrieve normal webpages, as well as useful data (eg. weather) from public APIs.</p>
<p>You can find a list of public APIs here <a href="https://github.com/public-apis/public-apis">https://github.com/public-apis/public-apis</a>.
Many more can be found if you dig around online.</p>
<p>You can also retrieve webpages (HTML), but be warned that some webpages may be very large, and your device may not have enough memory to load the entire page.</p>
<h2>Code</h2>
<p>This code will retrieve the maximum temperature in Singapore today from <a href="https://open-meteo.com/">Open-Meteo</a>.</p>
<p>It will display the full data returned by Open-Meteo, then extract out and print just the max temperature.</p>
<p>If you want to retrieve other weather data, you'll need to change the URL.
Open this page, <a href="https://open-meteo.com/en/docs">https://open-meteo.com/en/docs</a>, change the settings, then get the new URL from the <strong>API URL</strong> section.</p>
<h3>Blocks</h3>
<p><img alt="" src="images/urequests_blocks.webp" /></p>
<p>You must put in your actual WiFi SSID and password in the <code>Connect to WiFi</code> block, or this will not work.</p>
<p>The above screenshot does not show the full URL, it should be <strong>https://api.open-meteo.com/v1/forecast?latitude=1.2897&amp;longitude=103.8501&amp;daily=temperature_2m_max&amp;timezone=Asia%2FSingapore&amp;forecast_days=1</strong> (...in a single line).</p>
<p>Most web-based APIs will return JSON data.
If your API isn't returning JSON, or if you are retrieving a webpage, then you'll need to set the format as <strong>Text</strong>.</p>
<h3>Python</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">network</span>
<span class="kn">import</span> <span class="nn">urequests</span>

<span class="c1"># Connect to WiFi</span>
<span class="n">ioty_wifi</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span>
<span class="n">ioty_wifi</span><span class="o">.</span><span class="n">active</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ioty_wifi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;SSID&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span> <span class="c1"># Put in actual WiFi SSID/Password</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">ioty_wifi</span><span class="o">.</span><span class="n">isconnected</span><span class="p">():</span>
    <span class="k">pass</span> <span class="c1"># Do nothing until wifi is connected</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Connected to WiFi&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">urequest</span> <span class="o">=</span> <span class="n">urequests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://api.open-meteo.com/v1/forecast?latitude=1.2897&amp;longitude=103.8501&amp;daily=temperature_2m_max&amp;timezone=Asia</span><span class="si">%2F</span><span class="s1">Singapore&amp;forecast_days=1&#39;</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">urequest</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c1"># JSON decode the response and put the result in &quot;item&quot;</span>
    <span class="n">urequest</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span> <span class="c1"># If the request fails (eg. server down), it will throw an exception.</span>
    <span class="k">pass</span>
<span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="c1"># Print everything</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Max Temperature:&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="s1">&#39;temperature_2m_max&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div>

<h3>Results</h3>
<p>A few seconds after reset, you should see "Connected to WiFi", which indicates that your device has successfully connected to your WiFi.
If this does not appear, you'll need to troubleshoot your WiFi connection.
Check that...</p>
<ul>
<li>WiFi SSID and Password are correct.</li>
<li>WiFi SSID is for 2.4GHz and not 5GHz.</li>
</ul>
<p>After connecting to WiFi, your device will retrieve data from Open-Meteo, and print it twice; the first will show all the data returned, while the second will only show the max temperature.</p>
<h1><code>urequests</code> - send and retrieve data via HTTP</h1>
<div class="custom_lib_docs">
<h2>Constructors</h2>
<p>None.</p>
<p>Use the <code>request</code> function.</p>
<h2>Functions</h2>
<h3>urequests.request(method, url, data=None, json=None, headers={}, auth=None, timeout=None, parse_headers=True)</h3>
<p>Make a HTTP request.</p>
<p>The arguments are:</p>
<ul>
<li>
<p><code>method</code> A string. Must be one of the following.</p>
<ul>
<li>
<p><code>GET</code> This is the most common type of HTTP request, and is used when retrieving data. Most APIs will use this.</p>
</li>
<li>
<p><code>POST</code> This type of request is used when making changes (eg. when sending a text message).</p>
</li>
<li>
<p><code>HEAD</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code> These are not commonly used.</p>
</li>
</ul>
</li>
<li>
<p><code>url</code> A string specifying the URL to retrieve.</p>
</li>
<li>
<p><code>data</code> A bytes object specifying the data to be sent to the server. Not used with <code>GET</code> requests.</p>
</li>
<li>
<p><code>json</code> Data to be sent to the server; <code>request</code> will convert it to JSON before sending it.</p>
</li>
<li>
<p><code>headers</code> A dictionary containing custom headers to be sent with the request. The key should be the header name and the content the header value.</p>
</li>
<li>
<p><code>auth</code> A list containing username and password for <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Access Authentication</a>.</p>
</li>
<li>
<p><code>timeout</code> A number specifying the duration to wait before timing out the HTTP request.</p>
</li>
<li>
<p><code>parse_headers</code> A boolean specifying whether to parse the response header.</p>
</li>
</ul>
<p>Returns a <code>Response</code> object. See below for methods of the <code>Response</code> object.</p>
<h2>Class</h2>
<h3>Response</h3>
<p>The <code>request</code> function will return a <code>Response</code> object, which provides properties and methods to read the HTTP response data.</p>
<h2>Properties</h2>
<h3>Response.content</h3>
<p>A bytes object containing the HTTP response data.</p>
<h3>Response.text</h3>
<p>A string containing the HTTP response data decoded using UTF-8.</p>
<h2>Methods</h2>
<h3>Response.close()</h3>
<p>Close the response object.</p>
<p>Returns <code>None</code>.</p>
<h3>Response.json()</h3>
<p>JSON decodes the HTTP response data and returns the resulting object.
This may throw an exception if the HTTP response data is not valid JSON.</p>
<p>Returns <code>None</code>.</p>
</div>
        </div>
        <button type="button" id="hamburger">
            <div id="hamburgerTop"></div>
            <div id="hamburgerBottom"></div>
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('hamburger').addEventListener('click', function() {
                document.getElementById('body').classList.toggle('close');
            });

            let currentEle = document.querySelector('#sidebar li.current');
            currentEle.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        });
    </script>
</body>
</html>