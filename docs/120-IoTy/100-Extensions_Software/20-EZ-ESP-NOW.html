<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="../../css/pygment_default.css" rel="stylesheet">
  <link href="../../css/main.css" rel="stylesheet">
  <link href="../../css/print.css" rel="stylesheet" media="print">

  <title>IoTy Documentation</title>
</head>

<body>
    <div id="header">
        <div id="header-left">
            <a id="home" href="../../index.html"><i class="fa fa-home"></i></a>
            &nbsp;&nbsp;/&nbsp;&nbsp;
            IoTy Documentation
        </div>
        <div id="header-right">
            <a href="https://aposteriori.com.sg">
                <img src="../../images/logo.png">
            </a>
        </div>
    </div>

    <div id="body">
        <div id="sidebarOverlay"></div>
        <nav id="sidebar" role="navigation">
            <div id="sidebarHeader">Internet-of-Things made easy</div>
            <p>Intro to IoTy</p><ul><a href="../10-Introduction/10-Intro.html"><li >Introduction</li></a><a href="../10-Introduction/20-First-Program.html"><li >First Program</li></a><a href="../10-Introduction/30-Connection-Modes.html"><li >Connection Modes</li></a><a href="../10-Introduction/40-Monitor.html"><li >Monitor</li></a></ul><p>Basic Features (GPIO)</p><ul><a href="../20-Basics-GPIO/10-GPIO-Pins.html"><li >GPIO Pins</li></a><a href="../20-Basics-GPIO/20-Analog-Read-and-Write.html"><li >Analog Read and Write</li></a><a href="../20-Basics-GPIO/30-Servo.html"><li >Servo</li></a><a href="../20-Basics-GPIO/40-Ultrasonic-Distance.html"><li >Ultrasonic Distance (HC-SR04)</li></a><a href="../20-Basics-GPIO/99-Python-Docs---pin.html"><li >Python Docs - pin</li></a></ul><p>Extensions (Software)</p><ul><a href="../100-Extensions_Software/10-urequests.html"><li >HTTP Requests (urequests)</li></a><a href="../100-Extensions_Software/20-EZ-ESP-NOW.html"><li class="current">EZ ESP-NOW</li></a><a href="../100-Extensions_Software/30-EZ-HTTPD.html"><li >EZ HTTP (Web Server)</li></a><a href="../100-Extensions_Software/40-non-block.html"><li >Non-Blocking Read</li></a><a href="../100-Extensions_Software/50-EZ-Timer.html"><li >EZ Timer</li></a></ul><p>Extensions (Hardware)</p><ul><a href="../110-Extensions_Hardware/10-Gyro.html"><li >Gyro (MPU-6050)</li></a><a href="../110-Extensions_Hardware/20-Servo-driver.html"><li >Servo Driver (PCA9685)</li></a><a href="../110-Extensions_Hardware/30-SSD1306.html"><li >OLED Screen (SSD1306)</li></a><a href="../110-Extensions_Hardware/40-Neopixel.html"><li >Neopixel (WS2812 LEDs)</li></a><a href="../110-Extensions_Hardware/50-I2C-LCD.html"><li >I2C LCD (HD44780 + PCF8574)</li></a><a href="../110-Extensions_Hardware/60-DHT11.html"><li >Temperature and Humidity (DHT11, DHT22, AM2302)</li></a><a href="../110-Extensions_Hardware/70-EZ-DS18X20.html"><li >Temperature Sensor (DS18S20, DS18B20)</li></a><a href="../110-Extensions_Hardware/80-GPS.html"><li >GPS (NMEA over serial)</li></a><a href="../110-Extensions_Hardware/90-hx711.html"><li >Analog-to-Digital (HX711)</li></a><a href="../110-Extensions_Hardware/100-hx710.html"><li >Analog-to-Digital (HX710)</li></a><a href="../110-Extensions_Hardware/110-MFRC522.html"><li >RFID Reader (MFRC522)</li></a><a href="../110-Extensions_Hardware/120-Magnetic-Sensor.html"><li >Magnetic Sensor (QMC5883L, HMC5883L)</li></a><a href="../110-Extensions_Hardware/130-Barometric-Pressure.html"><li >Barometric Pressure (BMP280, BME280)</li></a><a href="../110-Extensions_Hardware/140-Heart-Rate.html"><li >Heart Rate Sensor (MAX30102)</li></a><a href="../110-Extensions_Hardware/150-ToF.html"><li >Laser Ranging (VL53L0X, VL52L1X)</li></a></ul><p>Others Components</p><ul><a href="../200-Others/10-hbridge.html"><li >Intro to H-Bridge</li></a><a href="../200-Others/12-hbridgeControl2Pins.html"><li >Controlling a H-Bridge (2 pins)</li></a><a href="../200-Others/14-hbridgeControl3Pins.html"><li >Controlling a H-Bridge (3 pins)</li></a></ul>
        </nav>
        <div id="content">
            <h1>EZ ESP-NOW</h1>
<p>The ESP-NOW protocol allows direct communication between up to 20 registered peers, without requiring a WiFi access point.
In normal usage, peers needs to be registered using their MAC address, and only string and bytes can be sent.</p>
<p>EZ ESP-NOW simplify the use of ESP-NOW.
When using EZ ESP-NOW, you won't need the recipient's MAC address, instead, each device will set a group, and messages are broadcast to all devices within the same group (similar to the microbit "radio").
EZ ESP-NOW also allows you to send other data types (eg. list, dictionaries).</p>
<h2>Code</h2>
<p>This sample code requires two devices, one to send and another to receive.</p>
<p>The sender device will send "Hello" when the boot button is pressed.</p>
<p>The receiving device will print the recieved message and flash the built-in LED when it arrives.</p>
<h3>Blocks</h3>
<p><strong>Sender</strong></p>
<p><img alt="" src="images/ez_espnow_blocks_sender.webp" /></p>
<p><strong>Receiver</strong></p>
<p><img alt="" src="images/ez_espnow_blocks_receiver.webp" /></p>
<h3>Python</h3>
<p><strong>Sender</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ez_espnow</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">ioty</span> <span class="kn">import</span> <span class="n">pin</span>

<span class="n">ez_espnow</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">ez_espnow</span><span class="o">.</span><span class="n">set_group</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">pin</span><span class="o">.</span><span class="n">digital_read</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ez_espnow</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<p><strong>Receiver</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ez_espnow</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">ioty</span> <span class="kn">import</span> <span class="n">pin</span>

<span class="n">ez_espnow</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">ez_espnow</span><span class="o">.</span><span class="n">set_group</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ez_espnow</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">pin</span><span class="o">.</span><span class="n">digital_write</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pin</span><span class="o">.</span><span class="n">digital_write</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h3>Results</h3>
<p>When the boot button is pressed on the sender, the receiver device should print "Hello" to the monitor and flash the built-in blue LED.</p>
<h2>ESP-NOW and WiFi</h2>
<p>ESP-NOW can work even when your device is connected to a WiFi network, but there will be some impact.</p>
<ol>
<li>
<p>Wifi Power-saving Mode is automatically activated, making it unreliable in receiving ESP-NOW messages.
You can work around this by disabling power saving; <code>sta.config(pm=sta.PM_NONE)</code>.</p>
</li>
<li>
<p>The radio on the esp device changes wifi channel to match the channel used by the Access Point.
You'll need to ensure that all devices are set to the same WiFi channel.
Use <code>sta.config("channel")</code> to retrieve the current channel, and <code>sta.config(channel=X)</code> (where <code>X</code> is the channel number) to set the channel.</p>
</li>
</ol>
<h1><code>ez_espnow</code> - easy use of ESP-NOW</h1>
<div class="custom_lib_docs">
<h2>Constructors</h2>
<p>None.</p>
<p>Use the functions provided by <code>ez_espnow</code>.</p>
<h2>Functions</h2>
<h3>ez_espnow.init()</h3>
<p>Initialize ESP-NOW.</p>
<p>Returns <code>None</code>.</p>
<h3>ez_espnow.set_group(g)</h3>
<p>Set the group.
Devices in the same group can send and receive messages from each other.</p>
<p>The arguments are:</p>
<ul>
<li><code>g</code> An integer specifying the group number. Any number can be used.</li>
</ul>
<p>Returns <code>None</code>.</p>
<h3>ez_espnow.send(message)</h3>
<p>Send a message.
All devices within range and in the same group will receive the message.</p>
<p>The arguments are:</p>
<ul>
<li><code>message</code> Any data type. The supplied data will be JSON encoded before it is sent.</li>
</ul>
<p>Returns <code>None</code>.</p>
<h3>ez_espnow.recv(wait)</h3>
<p>Receive data sent by other devices in the same group.</p>
<p>The arguments are:</p>
<ul>
<li><code>wait</code> A boolean. If <code>True</code>, this will block until a message is received. If <code>False</code>, it will return <code>None</code> if there are no messages available.</li>
</ul>
<p>Returns the sent data. May return <code>None</code> if wait is <code>False</code>.</p>
</div>
        </div>
        <button type="button" id="hamburger">
            <div id="hamburgerTop"></div>
            <div id="hamburgerBottom"></div>
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('hamburger').addEventListener('click', function() {
                document.getElementById('body').classList.toggle('close');
            });

            let currentEle = document.querySelector('#sidebar li.current');
            currentEle.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });
        });
    </script>
</body>
</html>