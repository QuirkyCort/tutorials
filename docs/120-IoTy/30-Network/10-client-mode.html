<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="../../css/pygment_default.css" rel="stylesheet">
  <link href="../../css/main.css" rel="stylesheet">
  <link href="../../css/print.css" rel="stylesheet" media="print">

  <title>IoTy Documentation</title>
</head>

<body>
    <div id="header">
        <div id="header-left">
            <a id="home" href="../../index.html"><i class="fa fa-home"></i></a>
            &nbsp;&nbsp;/&nbsp;&nbsp;
            IoTy Documentation
        </div>
        <div id="header-right">
            <a href="https://aposteriori.com.sg">
                <img src="../../images/logo.png">
            </a>
        </div>
    </div>

    <div id="body">
        <div id="sidebarOverlay"></div>
        <nav id="sidebar" role="navigation">
            <div id="sidebarHeader">Internet-of-Things made easy</div>
            <p class="sectionTitle close" data-section="IntrotoIoTy"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Intro to IoTy</p><ul class="IntrotoIoTy hide"><a href="../10-Introduction/10-Intro.html"><li >Introduction</li></a><a href="../10-Introduction/20-First-Program.html"><li >First Program</li></a><a href="../10-Introduction/30-Connection-Modes.html"><li >Connection Modes</li></a><a href="../10-Introduction/40-Monitor.html"><li >Monitor</li></a></ul><p class="sectionTitle close" data-section="BasicFeaturesGPIO"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Basic Features (GPIO)</p><ul class="BasicFeaturesGPIO hide"><a href="../20-Basics-GPIO/10-GPIO-Pins.html"><li >GPIO Pins</li></a><a href="../20-Basics-GPIO/20-Analog-Read-and-Write.html"><li >Analog Read and Write</li></a><a href="../20-Basics-GPIO/30-Servo.html"><li >Servo</li></a><a href="../20-Basics-GPIO/40-Ultrasonic-Distance.html"><li >Ultrasonic Distance (HC-SR04)</li></a><a href="../20-Basics-GPIO/99-Python-Docs---pin.html"><li >Python Docs - pin</li></a><a href="../20-Basics-GPIO/100-Pinout.html"><li >Pinouts</li></a></ul><p class="sectionTitle close" data-section="Network"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Network</p><ul class="Network hide"><a href="../30-Network/10-client-mode.html"><li class="current">Client Mode</li></a><a href="../30-Network/20-ap-mode.html"><li >Access Point Mode</li></a><a href="../30-Network/30-mqtt.html"><li >MQTT</li></a></ul><p class="sectionTitle close" data-section="ExtensionsSoftware"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Extensions (Software)</p><ul class="ExtensionsSoftware hide"><a href="../100-Extensions_Software/10-urequests.html"><li >HTTP Requests (urequests)</li></a><a href="../100-Extensions_Software/20-EZ-ESP-NOW.html"><li >EZ ESP-NOW</li></a><a href="../100-Extensions_Software/30-EZ-HTTPD.html"><li >EZ HTTP (Web Server)</li></a><a href="../100-Extensions_Software/40-non-block.html"><li >Non-Blocking Read</li></a><a href="../100-Extensions_Software/50-EZ-Timer.html"><li >EZ Timer</li></a><a href="../100-Extensions_Software/60-tween.html"><li >Tween</li></a><a href="../100-Extensions_Software/70-BLE-HID.html"><li >Bluetooth Low Energy Human Interface Device</li></a></ul><p class="sectionTitle close" data-section="ExtensionsHardware"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Extensions (Hardware)</p><ul class="ExtensionsHardware hide"><a href="../110-Extensions_Hardware/10-Gyro.html"><li >Gyro (MPU-6050)</li></a><a href="../110-Extensions_Hardware/20-Servo-driver.html"><li >Servo Driver (PCA9685)</li></a><a href="../110-Extensions_Hardware/30-SSD1306.html"><li >OLED Screen (SSD1306 / SH1106)</li></a><a href="../110-Extensions_Hardware/40-Neopixel.html"><li >Neopixel (WS2812 LEDs)</li></a><a href="../110-Extensions_Hardware/50-I2C-LCD.html"><li >I2C LCD (HD44780 + PCF8574)</li></a><a href="../110-Extensions_Hardware/60-DHT11.html"><li >Temperature and Humidity (DHT11, DHT22, AM2302)</li></a><a href="../110-Extensions_Hardware/70-EZ-DS18X20.html"><li >Temperature Sensor (DS18S20, DS18B20)</li></a><a href="../110-Extensions_Hardware/80-GPS.html"><li >GPS (NMEA over serial)</li></a><a href="../110-Extensions_Hardware/90-hx711.html"><li >Analog-to-Digital (HX711)</li></a><a href="../110-Extensions_Hardware/100-hx710.html"><li >Analog-to-Digital (HX710)</li></a><a href="../110-Extensions_Hardware/110-MFRC522.html"><li >RFID Reader (MFRC522)</li></a><a href="../110-Extensions_Hardware/120-Magnetic-Sensor.html"><li >Magnetic Sensor (QMC5883L, HMC5883L)</li></a><a href="../110-Extensions_Hardware/130-Barometric-Pressure.html"><li >Barometric Pressure (BMP280, BME280)</li></a><a href="../110-Extensions_Hardware/140-Heart-Rate.html"><li >Heart Rate Sensor (MAX30102)</li></a><a href="../110-Extensions_Hardware/150-ToF.html"><li >Laser Ranging (VL53L0X, VL52L1X)</li></a><a href="../110-Extensions_Hardware/160-rtc-ds3231.html"><li >Real-Time Clock (DS3231)</li></a><a href="../110-Extensions_Hardware/170-apds9960.html"><li >Light, Proximity, Gesture (APDS9960)</li></a><a href="../110-Extensions_Hardware/180-gy33_i2c.html"><li >Color Sensor (GY-33, I2C)</li></a><a href="../110-Extensions_Hardware/190-gy33_uart.html"><li >Color Sensor (GY-33, UART)</li></a><a href="../110-Extensions_Hardware/200-tcs3472.html"><li >Color Sensor (TCS3472)</li></a><a href="../110-Extensions_Hardware/210-max6675.html"><li >Thermocouple Board (MAX6675)</li></a><a href="../110-Extensions_Hardware/220-encoder.html"><li >Incremental Encoder</li></a><a href="../110-Extensions_Hardware/230-husky-lens.html"><li >Husky Lens</li></a><a href="../110-Extensions_Hardware/250-music.html"><li >Music</li></a><a href="../110-Extensions_Hardware/260-Scaled-Text.html"><li >Scaled Text</li></a><a href="../110-Extensions_Hardware/270-PNG-decoder.html"><li >PNG Decoder</li></a><a href="../110-Extensions_Hardware/280-BMP-Image.html"><li >BMP Image</li></a><a href="../110-Extensions_Hardware/290-serial-mp3.html"><li >Serial MP3 Player (YX5300, YX6300)</li></a><a href="../110-Extensions_Hardware/300-ld2410.html"><li >Human Presence Radar (LD2410)</li></a></ul><p class="sectionTitle close" data-section="OthersComponents"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Others Components</p><ul class="OthersComponents hide"><a href="../200-Others/10-hbridge.html"><li >Intro to H-Bridge</li></a><a href="../200-Others/12-hbridgeControl2Pins.html"><li >Controlling a H-Bridge (2 pins)</li></a><a href="../200-Others/14-hbridgeControl3Pins.html"><li >Controlling a H-Bridge (3 pins)</li></a></ul>
        </nav>
        <div id="content">
            <h1>Client Mode</h1>
<p><img alt="" src="images/station_mode.webp" /></p>
<p>In Client Mode (aka. Station Mode), your IoTy device will connect to a WiFi router.</p>
<div class="important">
Some WiFi networks requires you to open a webpage and sign in after connection (...common with free WiFi at hotels, coffee shops, airports, etc). These are called captive portals and they won't work with your IoTy device.
</div>

<p>Your device will have internet access (...provided your router is connected to the internet), and will be able to...</p>
<ul>
<li>Retrieve webpages and data (see urequest extension)</li>
<li>Connect to an MQTT broker (see the MQTT page for more info)</li>
<li>Act as a webserver (see EZ HTTPD extension)</li>
</ul>
<div class="important">
To act as a webserver, the router must allow incoming connections to your IoTy device. Home routers usually allows this, as long as the connection is coming from another device connected to the same router. Public routers and phone hotspots usually do not allow this at all.
</div>

<h2>Basic Connection</h2>
<p>This example connects to WiFi, retrieves the date/time, and prints it out.
You must put in your actual WiFi SSID and password or this will not work.</p>
<h3>Blocks</h3>
<p><img alt="" src="images/basic_client.webp" /></p>
<p>Note that the <code>set date/time</code> block is under the <code>Control</code> category.</p>
<h3>Python</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ioty.wifi</span>
<span class="kn">import</span> <span class="nn">ntptime</span>
<span class="kn">import</span> <span class="nn">machine</span>

<span class="n">ioty</span><span class="o">.</span><span class="n">wifi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;SSID&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span> <span class="c1"># Put in actual WiFi SSID/Password</span>

<span class="c1"># Retrieves the UTC time from the internet and set your device clock to it</span>
<span class="n">ntptime</span><span class="o">.</span><span class="n">settime</span><span class="p">()</span>

<span class="c1"># Retrieve the time, add 8 hours, and set it back.</span>
<span class="c1"># This changes the time from UTC to UTC+8</span>
<span class="c1"># UTC+8 is the timezone here in Singapore; change if you live somewhere else.</span>
<span class="n">dateTime</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>
<span class="n">dateTime</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">8</span>
<span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">dateTime</span><span class="p">)</span>

<span class="c1"># Prints the date/time</span>
<span class="nb">print</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>
</code></pre></div>

<div class="tip">
<code>ntptime.settime()</code> may fail due to network conditions and throw an exception. It's best to put it in a <code>try except</code> to handle such failures.
</div>

<h2>Multiple Routers</h2>
<p>You may want to use your device at home (...using home router), and outside (...using phone hotspot).
In such cases, you can first check which router is present before trying to connect to it.</p>
<p>This example demonstrates checking for the presence of two different routers, before connecting and printing the assigned IP address.</p>
<h3>Blocks</h3>
<p><img alt="" src="images/multiple_routers.webp" /></p>
<h3>Python</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ioty.wifi</span>
<span class="kn">import</span> <span class="nn">ntptime</span>
<span class="kn">import</span> <span class="nn">machine</span>

<span class="n">routers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;MAIN_ROUTER&#39;</span><span class="p">,</span> <span class="s1">&#39;password1&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;BACKUP_ROUTER&#39;</span><span class="p">,</span> <span class="s1">&#39;password2&#39;</span><span class="p">]</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">router</span> <span class="ow">in</span> <span class="n">routers</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">ioty</span><span class="o">.</span><span class="n">wifi</span><span class="o">.</span><span class="n">is_present</span><span class="p">(</span><span class="n">router</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">ioty</span><span class="o">.</span><span class="n">wifi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">router</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">router</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">break</span>

<span class="k">if</span> <span class="n">ioty</span><span class="o">.</span><span class="n">wifi</span><span class="o">.</span><span class="n">isconnected</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ioty</span><span class="o">.</span><span class="n">wifi</span><span class="o">.</span><span class="n">get_ip</span><span class="p">())</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No WiFi&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="info">
The Python example uses a list and a loop, and is implemented quite differently from the Blocks example. The end result is however the same.
</div>

<h2>Scanning for WiFi</h2>
<p>Even without connecting to a router, simply scanning for the available WiFi can provide a rough indication of your device location (ie. at home or at school).</p>
<p>This example scans for WiFi, checks for the presence of the "HOME" router and "SCHOOL" router, and prints its approximate location.</p>
<h3>Blocks</h3>
<p><img alt="" src="images/scan_location.webp" /></p>
<h2>Python</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ioty.wifi</span>

<span class="n">routers</span> <span class="o">=</span> <span class="n">ioty</span><span class="o">.</span><span class="n">wifi</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
<span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;Unknown location&#39;</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">routers</span><span class="p">:</span>
    <span class="n">ssid</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ssid</span> <span class="o">==</span> <span class="s1">&#39;HOME&#39;</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;You&#39;re at home&quot;</span>
    <span class="k">elif</span> <span class="n">ssid</span> <span class="o">==</span> <span class="s1">&#39;SCHOOL&#39;</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;You&#39;re at school&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
</code></pre></div>

<div class="tip">
At large facilities such as a school, you may see the same SSID available throughout the entire area. These are actually multiple routers, all set to the same SSID. You can differentiate between them through their BSSID. This can be useful to determine your location within the facility, but it may take some work to compile the list of BSSID.
</div>
        </div>
        <button type="button" id="hamburger">
            <div id="hamburgerTop"></div>
            <div id="hamburgerBottom"></div>
        </button>
    </div>

    <script>
        function initHamburger() {
            document.getElementById('hamburger').addEventListener('click', function() {
                document.getElementById('body').classList.toggle('close');
            });
        }

        function initSectionMenu() {
            function clickHandler(evt) {
                let sectionTitle = evt.currentTarget;
                let classname = sectionTitle.attributes['data-section'].value;
                let sectionChild = document.querySelector('ul.' + classname);
                if (sectionChild.classList.contains('hide')) {
                    sectionChild.classList.remove('hide');
                    sectionTitle.classList.remove('close');
                } else {
                    sectionChild.classList.add('hide');
                    sectionTitle.classList.add('close');
                }
            }

            let sectionTitles = document.getElementsByClassName('sectionTitle');
            for (let sectionTitle of sectionTitles) {
                sectionTitle.addEventListener('click', clickHandler);
            }
        }

        function scrollSectionIntoView() {
            let currentEle = document.querySelector('#sidebar li.current');
            currentEle.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });

            let hiddenParent = currentEle.closest('.hide');
            if (hiddenParent) {
                hiddenParent.classList.remove('hide');
                hiddenParent.previousElementSibling.classList.remove('close');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            initHamburger();
            initSectionMenu();
            scrollSectionIntoView();
        });
    </script>
</body>
</html>