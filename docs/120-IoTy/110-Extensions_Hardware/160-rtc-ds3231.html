<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <link href="../../css/pygment_default.css" rel="stylesheet">
  <link href="../../css/main.css" rel="stylesheet">
  <link href="../../css/print.css" rel="stylesheet" media="print">

  <title>IoTy Documentation</title>
</head>

<body>
    <div id="header">
        <div id="header-left">
            <a id="home" href="../../index.html"><i class="fa fa-home"></i></a>
            &nbsp;&nbsp;/&nbsp;&nbsp;
            IoTy Documentation
        </div>
        <div id="header-right">
            <a href="https://aposteriori.com.sg">
                <img src="../../images/logo.png">
            </a>
        </div>
    </div>

    <div id="body">
        <div id="sidebarOverlay"></div>
        <nav id="sidebar" role="navigation">
            <div id="sidebarHeader">Internet-of-Things made easy</div>
            <p class="sectionTitle close" data-section="IntrotoIoTy"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Intro to IoTy</p><ul class="IntrotoIoTy hide"><a href="../10-Introduction/10-Intro.html"><li >Introduction</li></a><a href="../10-Introduction/20-First-Program.html"><li >First Program</li></a><a href="../10-Introduction/30-Connection-Modes.html"><li >Connection Modes</li></a><a href="../10-Introduction/40-Monitor.html"><li >Monitor</li></a></ul><p class="sectionTitle close" data-section="BasicFeaturesGPIO"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Basic Features (GPIO)</p><ul class="BasicFeaturesGPIO hide"><a href="../20-Basics-GPIO/10-GPIO-Pins.html"><li >GPIO Pins</li></a><a href="../20-Basics-GPIO/20-Analog-Read-and-Write.html"><li >Analog Read and Write</li></a><a href="../20-Basics-GPIO/30-Servo.html"><li >Servo</li></a><a href="../20-Basics-GPIO/40-Ultrasonic-Distance.html"><li >Ultrasonic Distance (HC-SR04)</li></a><a href="../20-Basics-GPIO/99-Python-Docs---pin.html"><li >Python Docs - pin</li></a></ul><p class="sectionTitle close" data-section="ExtensionsSoftware"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Extensions (Software)</p><ul class="ExtensionsSoftware hide"><a href="../100-Extensions_Software/10-urequests.html"><li >HTTP Requests (urequests)</li></a><a href="../100-Extensions_Software/20-EZ-ESP-NOW.html"><li >EZ ESP-NOW</li></a><a href="../100-Extensions_Software/30-EZ-HTTPD.html"><li >EZ HTTP (Web Server)</li></a><a href="../100-Extensions_Software/40-non-block.html"><li >Non-Blocking Read</li></a><a href="../100-Extensions_Software/50-EZ-Timer.html"><li >EZ Timer</li></a><a href="../100-Extensions_Software/60-tween.html"><li >Tween</li></a></ul><p class="sectionTitle close" data-section="ExtensionsHardware"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Extensions (Hardware)</p><ul class="ExtensionsHardware hide"><a href="../110-Extensions_Hardware/10-Gyro.html"><li >Gyro (MPU-6050)</li></a><a href="../110-Extensions_Hardware/20-Servo-driver.html"><li >Servo Driver (PCA9685)</li></a><a href="../110-Extensions_Hardware/30-SSD1306.html"><li >OLED Screen (SSD1306)</li></a><a href="../110-Extensions_Hardware/40-Neopixel.html"><li >Neopixel (WS2812 LEDs)</li></a><a href="../110-Extensions_Hardware/50-I2C-LCD.html"><li >I2C LCD (HD44780 + PCF8574)</li></a><a href="../110-Extensions_Hardware/60-DHT11.html"><li >Temperature and Humidity (DHT11, DHT22, AM2302)</li></a><a href="../110-Extensions_Hardware/70-EZ-DS18X20.html"><li >Temperature Sensor (DS18S20, DS18B20)</li></a><a href="../110-Extensions_Hardware/80-GPS.html"><li >GPS (NMEA over serial)</li></a><a href="../110-Extensions_Hardware/90-hx711.html"><li >Analog-to-Digital (HX711)</li></a><a href="../110-Extensions_Hardware/100-hx710.html"><li >Analog-to-Digital (HX710)</li></a><a href="../110-Extensions_Hardware/110-MFRC522.html"><li >RFID Reader (MFRC522)</li></a><a href="../110-Extensions_Hardware/120-Magnetic-Sensor.html"><li >Magnetic Sensor (QMC5883L, HMC5883L)</li></a><a href="../110-Extensions_Hardware/130-Barometric-Pressure.html"><li >Barometric Pressure (BMP280, BME280)</li></a><a href="../110-Extensions_Hardware/140-Heart-Rate.html"><li >Heart Rate Sensor (MAX30102)</li></a><a href="../110-Extensions_Hardware/150-ToF.html"><li >Laser Ranging (VL53L0X, VL52L1X)</li></a><a href="../110-Extensions_Hardware/160-rtc-ds3231.html"><li class="current">Real-Time Clock (DS3231)</li></a><a href="../110-Extensions_Hardware/170-apds9960.html"><li >Light, Proximity, Gesture (APDS9960)</li></a><a href="../110-Extensions_Hardware/180-gy33_i2c.html"><li >Color Sensor (GY-33, I2C)</li></a><a href="../110-Extensions_Hardware/190-gy33_uart.html"><li >Color Sensor (GY-33, UART)</li></a><a href="../110-Extensions_Hardware/200-tcs3472.html"><li >Color Sensor (TCS3472)</li></a><a href="../110-Extensions_Hardware/210-max6675.html"><li >Thermocouple Board (MAX6675)</li></a><a href="../110-Extensions_Hardware/220-encoder.html"><li >Incremental Encoder</li></a><a href="../110-Extensions_Hardware/230-husky-lens.html"><li >Husky Lens</li></a><a href="../110-Extensions_Hardware/250-music.html"><li >Music</li></a></ul><p class="sectionTitle close" data-section="OthersComponents"><i class="plus fa fa-plus-square-o" aria-hidden="true"></i><i class="minus fa fa-minus-square-o" aria-hidden="true"></i> Others Components</p><ul class="OthersComponents hide"><a href="../200-Others/10-hbridge.html"><li >Intro to H-Bridge</li></a><a href="../200-Others/12-hbridgeControl2Pins.html"><li >Controlling a H-Bridge (2 pins)</li></a><a href="../200-Others/14-hbridgeControl3Pins.html"><li >Controlling a H-Bridge (3 pins)</li></a></ul>
        </nav>
        <div id="content">
            <h1>Real-Time Clock (DS3231)</h1>
<p><img alt="" src="images/ds3231.webp" /></p>
<p>DS3231 is a low-cost real-time clock (RTC).
When equipped with a battery, it can continue to track the time even when the microcontroller is powered off.</p>
<p>The ESP32 is capable of retrieving the time from the internet, but this won't work if WiFi isn't available.
The DS3231 allows the ESP32 to retrieve the time anywhere, without relying on network connections.</p>
<h2>Pins</h2>
<p><img alt="" src="images/ds3231_pinout.webp" /></p>
<table>
<thead>
<tr>
<th>Pin</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>VCC</td>
<td>Power for the sensor. Connect to <strong>3V3</strong>.</td>
</tr>
<tr>
<td>GND</td>
<td>Ground pin. This should be connected to the <strong>GND</strong> pin on the ESP32.</td>
</tr>
<tr>
<td>SCL</td>
<td>Serial Clock. This is used to communicate with the ESP32 using the I2C protocol (default pin 18).</td>
</tr>
<tr>
<td>SDA</td>
<td>Serial Data. This is used to communicate with the ESP32 using the I2C protocol (default pin 19).</td>
</tr>
<tr>
<td>32K / SQW</td>
<td>Not in use. Leave unconnected.</td>
</tr>
</tbody>
</table>
<h2>Wiring</h2>
<p><img alt="" src="images/ds3231_wiring.webp" /></p>
<h2>Code</h2>
<p>There are 2 sets of code.</p>
<ol>
<li>
<p><strong>Set Time</strong> The controller connects to WiFi, retrieve the time, and save it to the DS3231. You need to run this code first, and the DS3231 must be equipped with a battery.</p>
</li>
<li>
<p><strong>Retrieve Time</strong> The controller retrieves the time from the DS3231, obtaining the time without requiring WiFi. It then prints out the time every second.</p>
</li>
</ol>
<h3>Blocks</h3>
<p><strong>Set Time</strong></p>
<p><img alt="" src="images/ds3231_blocks1.webp" /></p>
<p>You must put in your actual WiFi SSID and password in the <code>Connect to WiFi</code> block, or this will not work.</p>
<p><strong>Retrieve Time</strong></p>
<p><img alt="" src="images/ds3231_blocks2.webp" /></p>
<h3>Python</h3>
<p><strong>Set Time</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ioty.wifi</span>
<span class="kn">import</span> <span class="nn">ntptime</span>
<span class="kn">import</span> <span class="nn">machine</span>
<span class="kn">import</span> <span class="nn">ds3231</span>

<span class="n">ioty_wifi</span> <span class="o">=</span> <span class="n">ioty</span><span class="o">.</span><span class="n">wifi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;SSID&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span> <span class="c1"># Put in actual WiFi SSID/Password</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Connected to WiFi&#39;</span><span class="p">)</span>

<span class="n">ntptime</span><span class="o">.</span><span class="n">settime</span><span class="p">()</span>
<span class="n">dateTime</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>
<span class="n">dateTime</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">0</span>
<span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">dateTime</span><span class="p">)</span>
<span class="n">i2c0</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">I2C</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">ds3231_device</span> <span class="o">=</span> <span class="n">ds3231</span><span class="o">.</span><span class="n">DS3231</span><span class="p">(</span><span class="n">i2c0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)</span>
<span class="n">ds3231_device</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>
</code></pre></div>

<p><strong>Retrieve Time</strong></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">machine</span>
<span class="kn">import</span> <span class="nn">ds3231</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">i2c0</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">I2C</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">ds3231_device</span> <span class="o">=</span> <span class="n">ds3231</span><span class="o">.</span><span class="n">DS3231</span><span class="p">(</span><span class="n">i2c0</span><span class="p">,</span> <span class="mi">104</span><span class="p">)</span>
<span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">ds3231_device</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">RTC</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<h3>Results</h3>
<p><strong>Set Time</strong></p>
<p>Run this set of code first.
Make sure that WiFi is available.</p>
<p>Your device will retrieve the time and save it to the DS3231.
As long as the DS3231 is powered by the battery, it will continue to track the time even if the ESP32 is powered off.</p>
<p><strong>Retrieve Time</strong></p>
<p>The ESP32 won't connect to WiFi here, but will retrieve the time from the DS3231.</p>
<p>You should see the correct time printed in the monitor.
Even if you reset or power cycle (...power off and on) the ESP32, it will still continue to show the correct time.</p>
<h1><code>class DS3231</code> - control DS3231 real-time clock</h1>
<div class="custom_lib_docs">
<h2>Constructors</h2>
<h3>ds3231.DS3231(i2c, addr=104)</h3>
<p>Creates an DS3231 object.</p>
<p>The arguments are:</p>
<ul>
<li>
<p><code>i2c</code> An i2c object.</p>
</li>
<li>
<p><code>addr</code> The i2c address of the DS3231. By default, this should be 104.</p>
</li>
</ul>
<p>Returns a <code>DS3231</code> object.</p>
<h2>Methods</h2>
<h3>DS3231.datetime(dt=None)</h3>
<p>Gets or set the time.</p>
<p>If <code>dt</code> is not provided (<code>None</code>), it will return the date and time.</p>
<p>If <code>dt</code> is provided, it will set the date and time on the DS3231.</p>
<p>In both cases, the date and time should be in a format compatible with the <code>set date and time to</code> block or Python's <code>machine.RTC().datetime()</code>.</p>
<p>The arguments are:</p>
<ul>
<li><code>dt</code> A list containing <code>year, month, day, weekday, hours, minutes, seconds, subseconds</code>, or a <code>None</code>.</li>
</ul>
<p>Returns <code>None</code> if setting time, else a <code>tuple</code> containing 8 items <code>year, month, day, weekday, hours, minutes, seconds, subseconds</code>:</p>
<ul>
<li>
<p><code>year</code> An integer representing the year (eg. 2024).</p>
</li>
<li>
<p><code>month</code> An integer representing the month.</p>
</li>
<li>
<p><code>day</code> An integer representing the day.</p>
</li>
<li>
<p><code>weekday</code> An integer representing the day of the week.</p>
</li>
<li>
<p><code>hours</code> An integer representing the hour.</p>
</li>
<li>
<p><code>minutes</code> An integer representing the minute.</p>
</li>
<li>
<p><code>seconds</code> An integer representing the seconds.</p>
</li>
<li>
<p><code>subseconds</code> This is always <code>0</code>.</p>
</li>
</ul>
</div>
        </div>
        <button type="button" id="hamburger">
            <div id="hamburgerTop"></div>
            <div id="hamburgerBottom"></div>
        </button>
    </div>

    <script>
        function initHamburger() {
            document.getElementById('hamburger').addEventListener('click', function() {
                document.getElementById('body').classList.toggle('close');
            });
        }

        function initSectionMenu() {
            function clickHandler(evt) {
                let sectionTitle = evt.currentTarget;
                let classname = sectionTitle.attributes['data-section'].value;
                let sectionChild = document.querySelector('ul.' + classname);
                if (sectionChild.classList.contains('hide')) {
                    sectionChild.classList.remove('hide');
                    sectionTitle.classList.remove('close');
                } else {
                    sectionChild.classList.add('hide');
                    sectionTitle.classList.add('close');
                }
            }

            let sectionTitles = document.getElementsByClassName('sectionTitle');
            for (let sectionTitle of sectionTitles) {
                sectionTitle.addEventListener('click', clickHandler);
            }
        }

        function scrollSectionIntoView() {
            let currentEle = document.querySelector('#sidebar li.current');
            currentEle.scrollIntoView({
                behavior: 'smooth',
                block: 'center'
            });

            let hiddenParent = currentEle.closest('.hide');
            if (hiddenParent) {
                hiddenParent.classList.remove('hide');
            }

            let closedParent = currentEle.closest('.close');
            if (closedParent) {
                closedParent.classList.remove('close');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            initHamburger();
            initSectionMenu();
            scrollSectionIntoView();
        });
    </script>
</body>
</html>